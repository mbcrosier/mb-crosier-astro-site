---
const { frontmatter } = Astro.props;
import BaseLayout from "./BaseLayout.astro";

// Parse the date string into a Date object
const pubDate = new Date(frontmatter.pubDate);

// Format the date
const formattedDate = new Intl.DateTimeFormat('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}).format(pubDate);

// Get the full URLs for images
const siteUrl = Astro.site || 'https://mbcrosier.com';
// If frontmatter has an image.url, use that, otherwise fall back to default
const defaultImage = new URL('/abstract-swirl.png', siteUrl).toString();
const pageImage = frontmatter.image?.url 
  ? new URL(frontmatter.image.url, siteUrl).toString()
  : defaultImage;

// Use the page image for all social sharing unless specifically overridden
const socialImage = frontmatter.socialImage 
  ? new URL(frontmatter.socialImage, siteUrl).toString()
  : pageImage;
const ogImage = frontmatter.ogImage 
  ? new URL(frontmatter.ogImage, siteUrl).toString()
  : socialImage;
const twitterImage = frontmatter.twitterImage 
  ? new URL(frontmatter.twitterImage, siteUrl).toString()
  : socialImage;

// Get alt text for the image
const imageAlt = frontmatter.image?.alt || 'Abstract swirl in blue and yellow';

// Create the JSON-LD structured data
const jsonLd = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": frontmatter.title,
  "description": frontmatter.description,
  "image": pageImage,
  "datePublished": frontmatter.pubDate,
  "author": {
    "@type": "Person",
    "name": frontmatter.author
  }
};
---
<BaseLayout 
  pageTitle={frontmatter.title}
  description={frontmatter.description}
  type="article"
  socialImage={socialImage}
  ogImage={ogImage}
  twitterImage={twitterImage}
  imageAlt={imageAlt}
>
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  <article class="blog-post">
    <header>
      <h1>{frontmatter.title}</h1>
      <h3>{formattedDate}</h3>
      <hr class="dotted">
    </header>

    <div class="content">
      <slot />
    </div>
  </article>
</BaseLayout>

<style>
  .blog-post {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  header {
    margin-bottom: 2rem;
    text-align: center;
  }

  h1 {
    margin-bottom: 0.5rem;
    font-size: 2.5rem;
    line-height: 1.2;
  }

  h3 {
    font-size: 1rem;
    margin: 0;
    color: #666;
    font-weight: normal;
  }

  .content {
    line-height: 1.6;
  }

  .content :global(h2) {
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    font-size: 1.75rem;
    color: #028090;
  }

  .content :global(h3) {
    margin-top: 2.5rem;
    margin-bottom: 1.2rem;
    font-size: 1.4rem;
    color: #00A896;
  }

  .content :global(p) {
    margin-bottom: 1.2rem;
    line-height: 1.7;
  }

  .content :global(ul),
  .content :global(ol) {
    margin: 1.2rem 0;
    padding-left: 1.5rem;
  }

  .content :global(li) {
    margin-bottom: 0.5rem;
    line-height: 1.7;
  }

  .content :global(li > ul),
  .content :global(li > ol) {
    margin: 0.5rem 0;
  }

  .content :global(img) {
    margin: 1.5rem auto;
    display: block;
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    border: 1px solid #eee;
  }

  .content :global(figure) {
    margin: 1.5rem 0;
    text-align: center;
  }

  .content :global(figcaption) {
    margin-top: 0.5rem;
    font-size: 0.95em;
    color: #666;
  }

  .content :global(blockquote) {
    border-left: 4px solid #ddd;
    margin: 1.5rem 0;
    padding: 0.5rem 0 0.5rem 1rem;
    color: #666;
    font-style: italic;
  }

  .content :global(code) {
    background-color: #f4f4f4;
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-size: 0.9em;
  }

  .content :global(pre) {
    background-color: #f4f4f4;
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1.5rem 0;
  }

  .content :global(pre code) {
    background-color: transparent;
    padding: 0;
  }

  .content :global(div[style*="display: flex"]) {
    gap: 16px;
    margin: 1.5rem 0;
    flex-wrap: wrap;
  }

  @media (max-width: 600px) {
    .blog-post {
      padding: 1rem 0.5rem;
    }

    h1 {
      font-size: 2rem;
    }

    .content :global(div[style*="display: flex"]) {
      flex-direction: column !important;
      gap: 1rem !important;
    }

    .content :global(div[style*="display: flex"] img) {
      width: 100% !important;
      max-width: 100% !important;
    }
  }
</style>